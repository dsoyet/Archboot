# Created by Tobias Powalowski <tpowa@archlinux.org>

install ()
{
    MODULES=" $(checked_modules "/drivers/net/" | grep -ve "wireless") "
    # add staging modules
    STAGING="et131x"
    for i in $STAGING; do
        MODULES="$MODULES $(checked_modules "/drivers/staging/$i")"
    done
    BINARIES="ping ping6 route nslookup telnet ssh arpd genl ifcfg ifstat ip lnstat nstat routef routel rtacct rtmon rtpr ss tc dhclient"
    FILES=""
    SCRIPT="arch_net"
    # add e100 firmware files
    add_file "/lib/firmware/e100/d101m_ucode.bin"     
    add_file "/lib/firmware/e100/d101s_ucode.bin"     
    add_file "/lib/firmware/e100/d102e_ucode.bin"
    # add acenic firmware files
    add_file "/lib/firmware/acenic/tg1.bin"
    add_file "/lib/firmware/acenic/tg2.bin"
    # add  cassini firmware files
    add_file "/lib/firmware/sun/cassini.bin"
    # add kaweth firmware files
    add_file "/lib/firmware/kaweth/new_code.bin"
    add_file "/lib/firmware/kaweth/new_code_fix.bin"
    add_file "/lib/firmware/kaweth/trigger_code.bin"
    add_file "/lib/firmware/kaweth/trigger_code_fix.bin"
    # add starfire firmware files
    add_file "/lib/firmware/adaptec/starfire_rx.bin"
    add_file "/lib/firmware/adaptec/starfire_tx.bin"
    # add tg3 firmware files
    add_file "/lib/firmware/tigon/tg3.bin"
    add_file "/lib/firmware/tigon/tg3_tso.bin"
    add_file "/lib/firmware/tigon/tg3_tso5.bin"
    add_file "/sbin/dhcpcd"
    add_file "/sbin/ifenslave"
    add_file "/usr/sbin/brctl"
    add_file "/etc/rc.d/network"
    add_file "/usr/share/archboot/net/etc/conf.d/dhcpcd" "/etc/conf.d/dhcpcd"
    add_file "/usr/share/archboot/net/etc/conf.d/bonding" "/etc/conf.d/bonding"
    add_file "/usr/share/archboot/net/etc/conf.d/bridges" "/etc/conf.d/bridges"
    for i in $(find /usr/lib/dhcpcd -type f); do
        add_file "$i"
    done
    add_file "/usr/share/archboot/net/etc/dhcpcd.conf" "/etc/dhcpcd.conf"
    add_dir "/var/lib/dhcpcd"
    add_file "/lib/tc/experimental.dist"
    add_file "/lib/tc/normal.dist"
    add_file "/lib/tc/pareto.dist"
    add_file "/lib/tc/paretonormal.dist"
    add_file "/usr/share/archboot/net/etc/iproute2/ematch_map" "/etc/iproute2/ematch_map"
    add_file "/usr/share/archboot/net/etc/iproute2/rt_dsfield" "/etc/iproute2/rt_dsfield"
    add_file "/usr/share/archboot/net/etc/iproute2/rt_protos" "/etc/iproute2/rt_protos"
    add_file "/usr/share/archboot/net/etc/iproute2/rt_realms" "/etc/iproute2/rt_realms"
    add_file "/usr/share/archboot/net/etc/iproute2/rt_scopes" "/etc/iproute2/rt_scopes"
    add_file "/usr/share/archboot/net/etc/iproute2/rt_tables" "/etc/iproute2/rt_tables"
    # add dhclient support
    add_file "/sbin/dhclient-script"
    add_dir "/var/lib/dhclient"
    add_dir "/var/state/dhcp"
    # fixing licenses
    add_file "/usr/share/licenses/db/LICENSE"
    add_file "/usr/share/licenses/dhcpcd/LICENSE"
    add_file "/usr/share/licenses/dhclient/LICENSE"
    add_file "/usr/share/licenses/dnsutils/LICENSE"
    add_file "/usr/share/licenses/heimdal/LICENSE"
    add_file "/usr/share/licenses/openssh/LICENCE"
    add_file "/usr/share/licenses/openssl/LICENSE"
    add_file "/usr/share/licenses/sqlite3/license.txt"
    add_file "/usr/share/licenses/tcp_wrappers/license.txt"
}

help ()
{
cat<<HELPEOF
  This hook includes the network on an arch boot image.
HELPEOF
}
