#!/bin/bash
# Created by Tobias Powalowski <tpowa@archlinux.org>

build ()
{
    add_checked_modules '/kernel/fs'
    apps="/sbin/mkswap /usr/bin/debugreiserfs /usr/bin/mkreiserfs /usr/bin/reiserfsck /usr/bin/reiserfstune \
          /usr/bin/resize_reiserfs /sbin/badblocks /sbin/blkid /sbin/debugfs /sbin/dumpe2fs /sbin/e2fsck \
	  /sbin/e2image /sbin/e2undo /sbin/findfs /sbin/fsck /sbin/logsave /sbin/mkfs.ext2 /sbin/resize2fs \
	  /usr/bin/chattr /usr/bin/lsattr /usr/sbin/e2freefrag /usr/sbin/filefrag /usr/bin/mkntfs \
	  /usr/bin/ntfscp /usr/bin/ntfsclone /usr/bin/ntfslabel /usr/bin/ntfsresize /usr/bin/ntfsundelete \
	  /usr/bin/ntfscat /usr/bin/ntfscluster /usr/bin/ntfscmp /usr/bin/ntfsfix /usr/bin/ntfsinfo /usr/bin/ntfsls \
	  /usr/bin/jfs_debugfs /usr/bin/jfs_fsck /usr/bin/jfs_fscklog /usr/bin/jfs_logdump /usr/bin/jfs_mkfs /usr/bin/jfs_tune \
	  /usr/bin/mkfs.xfs /usr/bin/xfs_repair /usr/bin/xfs_copy /usr/bin/xfs_db /usr/bin/xfs_growfs /usr/bin/xfs_io \
	  /usr/bin/xfs_logprint /usr/bin/xfs_mdrestore /usr/bin/xfs_quota /usr/bin/xfs_rtcp /usr/bin/mkdosfs /usr/bin/dosfsck \
	  /usr/bin/dosfslabel /usr/bin/lowntfs-3g /usr/bin/ntfs-3g /usr/bin/mount.cifs \
	  /usr/bin/cifs.upcall /sbin/fsck.ext2 /sbin/fsck.ext3 /sbin/fsck.ext4 \
	  /sbin/fsck.ext4dev /sbin/e2label /sbin/tune2fs /sbin/mkfs.ext3 /sbin/mkfs.ext4 /sbin/mke2fs /usr/bin/fsck.jfs \
	  /usr/bin/mkfs.jfs /sbin/wipefs /sbin/blockdev /usr/bin/btrfs /usr/bin/btrfs-convert /usr/bin/btrfs-debug-tree \
	  /usr/bin/btrfs-find-root /usr/bin/btrfs-image /usr/bin/btrfs-map-logical /usr/bin/btrfs-show-super \
	  /usr/bin/btrfs-show /usr/bin/btrfs-vol /usr/bin/btrfs-zero-log /usr/bin/btrfsck /usr/bin/btrfsctl \
	  /usr/bin/btrfstune /usr/bin/mkfs.btrfs /sbin/mkfs.nilfs2 /sbin/mount.nilfs2 /sbin/nilfs_cleanerd \
	  /sbin/umount.nilfs2 /usr/bin/chcp /usr/bin/dumpseg /usr/bin/lscp /usr/bin/lssu /usr/bin/mkcp /usr/bin/rmcp \
	  /sbin/fsck.cramfs /sbin/fsck.minix /sbin/fsfreeze /sbin/fstrim /sbin/mkfs.bfs /sbin/mkfs.cramfs \
	  /sbin/mkfs.minix /usr/bin/mkfs.f2fs"
    for i in $apps; do
        add_binary "$i"
    done
    appfiles="/usr/bin/compile_et /usr/bin/mk_cmds /usr/bin/fsck.xfs /usr/bin/xfs_admin /usr/bin/xfs_bmap \
              /usr/bin/xfs_check /usr/bin/xfs_freeze /usr/bin/xfs_info /usr/bin/xfs_metadump /usr/bin/xfs_mkfile \
	      /usr/bin/xfs_ncheck" 
    for i in $appfiles; do
        add_file "$i"
    done
    symlinks="/usr/bin/fsck.msdos /usr/bin/fsck.vfat /usr/bin/fsck.reiserfs /usr/bin/mkfs.vfat /usr/bin/mkfs.msdos \
              /usr/bin/mkfs.ntfs /usr/bin/mkfs.reiserfs /usr/bin/mount.nfs4 /usr/bin/mount.ntfs /usr/bin/mount.lowntfs-3g \
              /usr/bin/mount.ntfs-3g /usr/bin/umount.nfs /usr/bin/umount.nfs4"
    for i in $symlinks; do
        add_binary "$(which $(basename $(readlink "$i")))"
        add_symlink "$i" "$(which $(basename $(readlink "$i")))"
    done
    add_file "/etc/nilfs_cleanerd.conf"
    # fix licenses
    add_file "/usr/share/licenses/e2fsprogs/MIT-LICENSE"
}

help ()
{
cat<<HELPEOF
  This hook is responsible for including filesystems on an arch boot image.
HELPEOF
}
