#!/usr/bin/env bash
# SPDX-License-Identifier: GPL-2.0-only
# Created by Tobias Powalowski <tpowa@archlinux.org>

build ()
{
    ### generate motd
    MOTD=$(mktemp /var/tmp/motd.XXXX)
    [[ "$(uname -m)" == "x86_64" ]] && echo -e "\e[1mWelcome to \e[36mArchboot\e[0m\e[1m - Arch Linux X86_64\e[0m" >> "${MOTD}"
    [[ "$(uname -m)" == "aarch64" ]] && echo -e "\e[1mWelcome to \e[36mArchboot\e[0m\e[1m - Arch Linux AARCH64\e[0m" >> "${MOTD}"
    [[ "$(uname -m)" == "riscv64" ]] && echo -e "\e[1mWelcome to \e[36mArchboot\e[0m\e[1m - Arch Linux RISCV64\e[0m" >> "${MOTD}"
    #shellcheck disable=SC2129
    echo -e "\e[1m----------------------------------------\e[0m" >> "${MOTD}"
    echo -e "\e[1mConsoles:\e[0m" >> "${MOTD}"
    echo -e "  - Virtual consoles \e[1m1-6\e[0m are active." >> "${MOTD}"
    echo -e "  - To change virtual console use \e[1m\e[92mALT + F(1-6)\e[0m" >> "${MOTD}"
if  echo "${HOOKS[@]}" | grep -qw archboot_keymap ; then
    echo -e "\e[1mChange keymap and console font:\e[0m" >> "${MOTD}"
    echo -e "  - To change to a non-US keymap, type \e[1m\e[92m'km'\e[0m at the console." >> "${MOTD}"
fi
if  echo "${HOOKS[@]}" | grep -qw archboot_tz; then
    echo -e "\e[1mChange time and date:\e[0m" >> "${MOTD}"
    echo -e "  - To change your time and date, type \e[1m\e[92m'tz'\e[0m at the console." >> "${MOTD}"
fi
if  echo "${HOOKS[@]}" | grep -qw archboot_net; then
    #shellcheck disable=SC2129
    echo -e "\e[1mFor wifi authentification to internet access or further online help:\e[0m" >> "${MOTD}"
    echo -e "  - Use the \e[1m\e[92m'elinks'\e[0m text mode browser." >> "${MOTD}"
    echo -e "\e[1mFor getting support on IRC channels:\e[0m" >> "${MOTD}"
    echo -e "  - Use the \e[1m\e[92m'weechat'\e[0m IRC client." >> "${MOTD}"
fi
if  echo "${HOOKS[@]}" | grep -qw archboot_installer; then
    echo -e "\e[1mManage Archboot Environment:\e[0m" >> "${MOTD}"
    echo -e "  - Run \e[1m\e[92m'update-installer'\e[0m to manage the Archboot Environment." >> "${MOTD}"
    #shellcheck disable=SC2129
    echo -e "\e[1mInstallation:\e[0m" >> "${MOTD}"
    echo -e "  - On first login \e[92m'setup'\e[0m is launched automatically." >> "${MOTD}"
    echo -e "  - Rerun \e[1m\e[92m'setup'\e[0m to continue installation." >> "${MOTD}"
    echo -e "\e[1mFor Experts:\e[0m" >> "${MOTD}"
    echo -e "  - Use \e[1m\e[92m'quickinst'\e[0m to install and bypass the setup routine." >> "${MOTD}"
fi
    chmod 644 "${MOTD}"
    add_file "${MOTD}" "/etc/motd"
}

help ()
{
cat <<HELPEOF
  This hook sets up dynamically the motd message, depending on
  your system.
HELPEOF
}
# vim: set ft=sh ts=4 sw=4 et:
