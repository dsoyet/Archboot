if [ ${grub_platform} == "efi" ]; then
    insmod all_video
    insmod efi_gop
    if [ ${grub_cpu} == "x86_64" ]; then
        insmod efi_uga
    elif [ ${grub_cpu} == "i386" ]; then
        insmod efi_uga
    fi
elif [ ${grub_platform} == "pc" ]; then
    insmod vbe
    insmod vga
    insmod png
fi
insmod video_bochs
insmod video_cirrus
insmod font
insmod serial
serial --unit=0 --speed=115200
if loadfont unicode ; then
    insmod gfxterm
    set gfxmode="auto"
    terminal_input console serial
    terminal_output gfxterm serial
    background_image /boot/grub/archboot-background.png
fi

set timeout="10"

if [ ${grub_platform} == "pc" ]; then
    set default="Arch Linux X86_64 Archboot - BIOS Mode"

    menuentry "Arch Linux x86_64 Archboot - BIOS Mode" {
        set gfxpayload=keep
        linux /boot/vmlinuz_x86_64 cgroup_disable=memory rootfstype=ramfs
        initrd /boot/intel-ucode.img  /boot/amd-ucode.img /boot/initramfs_x86_64.img
    }
fi

if [ ${grub_platform} == "efi" ]; then
    if [ ${grub_cpu} == "x86_64" ]; then
        set default="Arch Linux x86_64 Archboot"

        menuentry "Arch Linux x86_64 Archboot" {
            set gfxpayload=keep
            linux /boot/vmlinuz_x86_64 cgroup_disable=memory rootfstype=ramfs add_efi_memmap
            initrd /boot/intel-ucode.img  /boot/amd-ucode.img /boot/initramfs_x86_64.img
        }
        
        submenu "UEFI Tools" {
            menuentry "Secure Boot KeyTool" {
                chainloader /EFI/tools/KeyTool.efi
            }

            menuentry "Secure Boot HashTool" {
                chainloader /EFI/tools/HashTool.efi
            }
        
            menuentry "UEFI Shell X64 v2" {
                chainloader /EFI/tools/shellx64_v2.efi
            }

            menuentry "UEFI Shell X64 v1" {
                chainloader /EFI/tools/shellx64_v1.efi
            }
        }
    elif [ ${grub_cpu} == "arm64" ]; then
        set default="Arch Linux AA64 Archboot"

        menuentry "Arch Linux AA64 Archboot" {
            set gfxpayload=keep
            linux /boot/vmlinuz_aarch64 cgroup_disable=memory rootfstype=ramfs audit=0 nr_cpus=1 add_efi_memmap
            initrd /boot/amd-ucode.img /boot/initramfs_aarch64.img
        }
        
        submenu "UEFI Tools" {
            menuentry "Secure Boot KeyTool" {
                chainloader /EFI/tools/KeyTool.efi
            }

            menuentry "Secure Boot HashTool" {
                chainloader /EFI/tools/HashTool.efi
            }
        }
    elif [ ${grub_cpu} == "i386" ]; then
        set default="Arch Linux x86_64 Archboot - EFI MIXED MODE"
        
        menuentry "Arch Linux x86_64 Archboot - EFI MIXED MODE" {
                set gfxpayload=keep
                linux /boot/vmlinuz_x86_64 cgroup_disable=memory _IA32_UEFI=1 rootfstype=ramfs add_efi_memmap
                initrd /boot/intel-ucode.img  /boot/amd-ucode.img /boot/initramfs_x86_64.img
        }
        
        submenu "UEFI Tools" {
            menuentry "UEFI Shell IA32 v2" {
                chainloader /EFI/tools/shellia32_v2.efi
            }

            menuentry "UEFI Shell IA32 v1" {
                chainloader /EFI/tools/shellia32_v1.efi
            }
        }
    fi
    menuentry "Enter Firmware Setup" {
        fwsetup
    }
fi

menuentry "System reboot" {
    reboot
}

menuentry "System shutdown" {
    halt
}

menuentry "Exit GRUB" {
    exit
}

echo "Running menu entry ${chosen} ..."
